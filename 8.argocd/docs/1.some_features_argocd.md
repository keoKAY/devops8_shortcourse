## NOTE 

    
There are some features of argocd that worth taking note 


Date: 8-feb-2026 
Today teaching content: 
1. Explain the CI-CD process of autodeploying the reactjs application 
2. Reviews the Argocd important points to remember
3. Deploy the CICD process with the spring boot file uploads services 

One Helm-Repo for all 
One Helm-Repo per service 

*** 
1. Self-healing 
If someone manually change the kubernete resources (kubectl edit, hotfix, UI cilck), Argocd will detect the drift and revert back to what's defined in Git. 

Git = Source of truth 
```bash 
kubectl scale deployment api --replicas=10 
```
Without self-healing enabled 
- Cluster != Git 
- Argocd shows OutOfSync 
- No Automatic fix 

Without self-healing 
- Detect Drift 
- Automatically reapplicas git state
- Scale it back to the Git-defined replicas. 

```yaml 
syncPolicy: 
    automated: 
        selfHeal: true 
```

2. Self-Prune (Delete removed resourcee )
What is self-prune: 
If a resource is removed from Git, Argocd will delete it from the cluster. 

With Prune: 
- resource will be remove once it's no longer specified
Without Prune: 
- It keep running forever (Ghost resources )

3. Delete Propagation Policy
(Background vs Foreground )
This is a pure kubernets behaviors 
Why ? 
When you delete an Argocd Application , kubernetes must decide : 
- DO I delete child resource first or in  parallel?

3.1 Foreground Deletions 
How it works 
1. Delete all child resources first
2. Wait until they are fully gone 
3. Then delete the application 
> Slower but safe. 

```yaml 
syncPolicy: 
    syncOptions: 
        - PrunePropagationPolicy=foreground
```
When to use it 
- with database 
- with statefulsets
- anything that must shutdown cleanly 

3.2 Background deletion 
How it works
1. Application is deleted immediately
2. Child resourcesa re deleted asynchronously 
> Fast but less controlled 
```yaml 
syncPolicy: 
    syncOptions: 
        - PrunePropagationPolicy: background
```
When to use it 
- stateless apps
- Dev environment
- Fast cleanup needed. 


## Related Sync Windows 
It's a timebased rule that tells Argocd 
> During this time, allow or deny sync (automatically or manually ) for certain applications. 

Think of it a deployment curfew / deployment calendar 

- Why does it exists 
They tell you: 
- Prevents deployment during business hours 
- Blockc changes during incident windows 
- allow auto-sync only at night 
- control which app can sync and when. 

```bash 
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: production
spec:
  syncWindows:
    - kind: deny
      schedule: "0 9 * * 1-5"
      duration: 8h
      applications:
        - "*"
```
- kind: allow | deny 
- deny: Block sync during this windows
- allow : only allow sync during this windows 

```bash 
┌──────── minute (0–59)
│ ┌────── hour (0–23)
│ │ ┌──── day of month
│ │ │ ┌── month
│ │ │ │ ┌─ day of week (0–6 or Sun–Sat)
│ │ │ │ │
│ │ │ │ │
0 9 * * 1-5
```
> 9:00 AM, Monday-Friday 
**Duration**: How long does the window last. 
`duration: 8h`
So from :  9:00 -> 17:00

**Application (Filter)**
Which apps this rule applies to 
```yaml 
applications: 
- "*" 
```
or 
```yaml 
applications: 
- api-gateway 
- user-service 
```
or you can also use the pattern 
```yaml 
applications: 
    - prod-* 
```
- Some example for the sync windows 
    - Block Deployment during office hours 
```yaml 
syncWindows:
  - kind: deny
    schedule: "0 9 * * 1-5"
    duration: 8h
    applications:
      - "*"
```
> No sync from 9AM - 5PM 
> Autosync and manully sync blocked 

    - Allow deployments only at night 
```yaml 
syncWindows:
  - kind: allow
    schedule: "0 22 * * *"
    duration: 8h
    applications:
      - "*"
```
Allow sync from 10PM - 6PM 
```yaml
syncWindows:
  - kind: allow
    schedule: "0 22 * * *"
    duration: 8h
    applications:
      - "*"
```