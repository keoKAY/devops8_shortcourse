- name: Show Debug Google Instance
  debug:
    msg: "This is working fine "

- name: Ensure the package are installed
  pip:
    name:
      - requests
      - google-auth
- name: Create GCP instance
  google.cloud.gcp_compute_instance:
    name: "my-instance"
    machine_type: "e2-medium"
    zone: "us-central1-a"
    project: "{{google_project_id}}"
    auth_kind: "serviceaccount"
    service_account_file: "{{ service_account_path }}"
    state: absent
    disks:
      - auto_delete: true
        boot: true
        initialize_params:
          source_image: "projects/ubuntu-os-cloud/global/images/family/ubuntu-2004-lts"
          disk_size_gb: 20
          disk_type: "pd-standard"
    network_interfaces:
      - network: 
         selfLink: "projects/{{google_project_id}}/global/networks/default"
        access_configs:
          - name: External NAT
            type: ONE_TO_ONE_NAT
    tags:
      items:
        - http-server
        - https-server
  register: gcp_instance

- name: Show instance details
  debug:
    var: gcp_instance
